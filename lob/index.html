<html lang=ja>

<head>
<meta charset="utf-8">
<meta property="og:title" content="{{ タイトル }}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ URL }}" />
<meta property="og:image" content="{{ サムネ }}" />
<meta property="og:description" content="{{ 説明 }}" />
<meta property="og:locale" content="ja_JP" />
<meta property="og:locale:alternate" content="ja_JP" />
<meta property="og:site_name" content="" />
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@tech_chiba">
<meta name=twitter:creator content="@tech_chiba">
<title>{{ タイトル }}</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"/>

<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth__ja.js"></script>
<script src="./js/config.js"></script>

<link rel="stylesheet" href="./css/main.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="./js/tool.js"></script>
<script src="./js/tech.js"></script>
<script src="./js/main.js"></script>
</head>

<body>
    <input type='search' id='input' />
    
    <div>
        <h2>検索結果</h2>
        <div id='#results'></div>
    </div>
    
    <script>
window.onload = async () => {
    // 検索する
    var search = async () => {
        // 入力された値でを本を検索
        var items = await searchBooks(document.querySelector('#input').value);

        // html に変換して表示用 DOM に代入
        var texts = items.map(item => {
            return `
            <a class='f border bg-white mb8' href='${item.link}', target='_blank'>
            <img class='w100 object-fit-contain bg-gray' src='${item.image}' />
            <div class='p16'>
                <h3 class='mb8'>${item.title}</h3>
                <p class='line-clamp-2'>${item.description}</p>
            </div>
            </div>`;
        });
        document.querySelector('#results').innerHTML = texts.join('');
    };

        // 入力するたびに検索( debounce で API 連打対策 )
        document.querySelector('#input').oninput = _.debounce(search, 256);

        // フォーカスしたら全文字選択
        document.querySelector('#input').onfocus = () => { document.querySelector('#input').select(); };

        search();
    };

    // 本を検索して結果を返す
    var searchBooks = async (query) => {
        // Google Books APIs のエンドポイント
        var endpoint = 'https://www.googleapis.com/books/v1';

        // 検索 API を叩く
        var res = await fetch(`${endpoint}/volumes?q=${query}`);
        // JSON に変換
        var data = await res.json();

        // 必要なものだけ抜き出してわかりやすいフォーマットに変更する
        var items = data.items.map(item => {
        var vi = item.volumeInfo;
        return {
            title: vi.title,
            description: vi.description,
            link: vi.infoLink,
            image: vi.imageLinks ? vi.imageLinks.smallThumbnail : '',
        }; 
    });

    return items;
};
    </script>
</body>